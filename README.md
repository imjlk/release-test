# Monorepo Release Test

ì´ ì €ì¥ì†ŒëŠ” `sampo`ë¥¼ ì‚¬ìš©í•˜ì—¬ Node.js/Bun ëª¨ë…¸ë ˆí¬ì˜ ë²„ì „ ê´€ë¦¬ì™€ íŒ¨í‚¤ì§€ ë°°í¬ë¥¼ ìë™í™”í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

## ğŸš€ Sampo ì‚¬ìš© ê°€ì´ë“œ

**Sampo**ëŠ” Rustë¡œ ì‘ì„±ëœ Changesets ìŠ¤íƒ€ì¼ì˜ ë²„ì „ ê´€ë¦¬ ë„êµ¬ì…ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” GitHub Actionsë¥¼ í†µí•´ ë°°í¬ ìë™í™”ê°€ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### 1. ì„¤ì • (Setup)

ë¡œì»¬ í™˜ê²½ì—ì„œ ë³€ê²½ì‚¬í•­(Changeset)ì„ ìƒì„±í•˜ê¸° ìœ„í•´ `sampo` CLIë¥¼ ì„¤ì¹˜í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

```bash
# Rust/Cargoê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤
cargo install sampo
```

### 2. ê°œë°œ ì›Œí¬í”Œë¡œìš° (Workflow)

#### 2-1. ë³€ê²½ì‚¬í•­ ìƒì„± (Adding Changesets)

ì½”ë“œë¥¼ ìˆ˜ì •í•œ í›„, ë°°í¬í•  íŒ¨í‚¤ì§€ì˜ ë²„ì „ì„ ì˜¬ë¦¬ê¸° ìœ„í•´ **Changeset**ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
sampo add
```

ìœ„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤:
1.  ë³€ê²½ì‚¬í•­ì´ ìˆëŠ” íŒ¨í‚¤ì§€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
2.  ë²„ì „ ë³€ê²½ ìœ í˜•ì„ ì„ íƒí•©ë‹ˆë‹¤ (Major/Minor/Patch).
3.  ë³€ê²½ ë‚´ìš©(ìš”ì•½)ì„ ì…ë ¥í•©ë‹ˆë‹¤.

ì™„ë£Œë˜ë©´ `.sampo/changesets/` ë””ë ‰í† ë¦¬ì— ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. ì´ íŒŒì¼ì„ ì½”ë“œ ë³€ê²½ì‚¬í•­ê³¼ í•¨ê»˜ ì»¤ë°‹í•˜ì„¸ìš”.

```bash
git add .
git commit -m "feat: my new feature"
```

> **ì°¸ê³  (CLIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš°):**
> `.sampo/changesets/my-change.md`ì™€ ê°™ì€ íŒŒì¼ì„ ì§ì ‘ ìƒì„±í•˜ì—¬ ì•„ë˜ í˜•ì‹ì„ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
> ```markdown
> ---
> npm/test-a: minor
> ---
> 
> ì—¬ê¸°ì— ë³€ê²½ ì‚¬í•­ì„ ì ìŠµë‹ˆë‹¤.
> ```

#### 2-2. ë¦´ë¦¬ìŠ¤ í”„ë¡œì„¸ìŠ¤ (Release Process)

1.  **Pull Request**: ë³€ê²½ì‚¬í•­ê³¼ Changeset íŒŒì¼ì„ í¬í•¨í•˜ì—¬ `main` ë¸Œëœì¹˜ë¡œ PRì„ ë³´ëƒ…ë‹ˆë‹¤.
2.  **Version Bump**: `main`ì— ì½”ë“œê°€ ë³‘í•©ë˜ë©´, GitHub Actionsê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ "Release PR"ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    *   ì´ PRì€ ë²„ì „ì„ ì˜¬ë¦¬ê³ (ChangeLog ì—…ë°ì´íŠ¸ ë“±), Changesetì„ ì†Œë¹„(consume)í•˜ëŠ” ë‚´ìš©ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
3.  **Publish**: ìƒì„±ëœ "Release PR"ì„ ë³‘í•©í•˜ë©´, GitHub Actionsê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ì–´ ì‹¤ì œ NPM ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— íŒ¨í‚¤ì§€ë¥¼ ë°°í¬í•˜ê³  git íƒœê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### 3. ë””ë ‰í† ë¦¬ êµ¬ì¡°

*   `.sampo/config.toml`: Sampo ì„¤ì • íŒŒì¼
*   `.sampo/changesets/`: ë°°í¬ ì „ ëŒ€ê¸° ì¤‘ì¸ ë³€ê²½ì‚¬í•­ íŒŒì¼ë“¤ì´ ì €ì¥ë˜ëŠ” ê³³
*   `.github/workflows/release.yml`: ë°°í¬ ìë™í™” ì›Œí¬í”Œë¡œìš°
*   `packages/`: ëª¨ë…¸ë ˆí¬ íŒ¨í‚¤ì§€ë“¤

---

### ì£¼ì˜ì‚¬í•­
*   `packages/test-a/package.json`ì˜ `version` í•„ë“œëŠ” Sampoê°€ ê´€ë¦¬í•˜ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
*   **OIDC(Trusted Publishing) ì‚¬ìš© ì‹œ**:
    1.  NPM íŒ¨í‚¤ì§€ ì„¤ì • í˜ì´ì§€ì—ì„œ "Settings" -> "Trusted Publishers"ë¡œ ì´ë™í•©ë‹ˆë‹¤.
    2.  "Connect a CI/CD workflow"ë¥¼ í´ë¦­í•˜ê³  GitHub Actionsë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    3.  Repository owner, name, workflow filename(`release.yml`)ì„ ì…ë ¥í•˜ì—¬ ì—°ë™í•©ë‹ˆë‹¤.
    4.  ì´ì œ `NPM_TOKEN` ì—†ì´ë„ ì•ˆì „í•˜ê²Œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
